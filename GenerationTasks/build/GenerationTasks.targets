<?xml version="1.0" encoding="utf-8" standalone="no"?>
<Project>
  <!-- ServiceProjectReference support -->

  <Target Name="NSwagDocumentGenerator">
    <Message Importance="high" Text="%0ANSwagDocumentGenerator:" />
    <Message Importance="high" Text="  @(CurrentServiceProjectReference): %(DocumentPath)" />

    <ItemGroup>
      <!-- @(CurrentServiceProjectReference) item group will never contain more than one item. -->
      <CurrentServiceProjectReference Update="@(CurrentServiceProjectReference)">
        <Command>$(NSwagExe_Core21) aspnetcore2swagger /NoBuild:true</Command>
        <NSwagDocumentGeneratorOptions
            Condition="'%(NSwagDocumentGeneratorOptions)' == ''">$(NSwagDocumentGeneratorDefaultOptions)</DefaultDocumentGeneratorOptions>
      </CurrentServiceProjectReference>
      <CurrentServiceProjectReference Update="@(CurrentServiceProjectReference)">
        <Command>%(Command) /Project:%(FullPath) /output:%(DocumentPath) /TargetFramework:%(TargetFramework)</Command>
        <Command Condition="'%(ProjectConfiguration)' == ''">%(Command) /Configuration:$(Configuration)</Command>
        <Command Condition="'%(ProjectConfiguration)' != ''">%(Command) /Configuration:%(ProjectConfiguration)</Command>
        <Command Condition="'%(NSwagDocumentGeneratorOptions)' != ''">%(Command) %(NSwagDocumentGeneratorOptions)</Command>
      </CurrentServiceProjectReference>
    </ItemGroup>

    <Message Importance="high" Text="%0A%(CurrentServiceProjectReference.Command)" />
    <Exec IgnoreExitCode="$([System.IO.File]::Exists('%(DocumentPath)'))" Command="%(CurrentServiceProjectReference.Command)" />
  </Target>

  <!-- ServiceFileReference support for C# -->

  <Target Name="NSwagCSharpCodeGenerator">
    <Message Importance="high" Text="%0ANSwagCSharpCodeGenerator:" />
    <Message Importance="high" Text="  @(CurrentServiceFileReference): %(OutputPath)" />

    <ItemGroup>
      <!-- @(CurrentServiceFileReference) item group will never contain more than one item. -->
      <CurrentServiceFileReference Update="@(CurrentServiceFileReference)">
        <Command>$(NSwagExe_Core21) swagger2csclient /namespace:$(ServiceFileReferenceCSharpNamespace)</Command>
        <NSwagCSharpCodeGeneratorOptions
            Condition="'%(NSwagDocumentGeneratorOptions)' == ''">$(NSwagCSharpCodeGeneratorDefaultOptions)</NSwagCSharpCodeGeneratorOptions>
      </CurrentServiceFileReference>
      <CurrentServiceFileReference Update="@(CurrentServiceFileReference)">
        <Command>%(Command) /className:%(ClassName) /input:%(FullPath) /output:%(OutputPath)</Command>
        <Command
            Condition="'%(NSwagCSharpCodeGeneratorOptions)' != ''">%(Command) %(NSwagCSharpCodeGeneratorOptions)</Command>
      </CurrentServiceFileReference>
    </ItemGroup>

    <Message Importance="high" Text="%0A%(CurrentServiceFileReference.Command)" />
    <Exec IgnoreExitCode="$([System.IO.File]::Exists('%(OutputPath)'))" Command="%(CurrentServiceFileReference.Command)" />
  </Target>

  <!-- ServiceFileReference support for TypeScript -->

  <Target Name="NSwagTypeScriptCodeGenerator">
    <Message Importance="high" Text="%0ANSwagTypeScriptCodeGenerator:" />
    <Message Importance="high" Text="  @(CurrentServiceFileReference): %(OutputPath)" />

    <ItemGroup>
      <!-- @(CurrentServiceFileReference) item group will never contain more than one item. -->
      <CurrentServiceFileReference Update="@(CurrentServiceFileReference)">
        <Command>$(NSwagExe_Core21) swagger2tsclient /namespace:$(ServiceFileReferenceTypeScriptNamespace)</Command>
        <NSwagTypeScriptCodeGeneratorDefaultOptions
            Condition="'%(NSwagDocumentGeneratorOptions)' == ''">$(NSwagTypeScriptCodeGeneratorDefaultOptions)</NSwagTypeScriptCodeGeneratorDefaultOptions>
      </CurrentServiceFileReference>
      <CurrentServiceFileReference Update="@(CurrentServiceFileReference)">
        <Command>%(Command) /className:%(ClassName) /input:%(FullPath) /output:%(OutputPath)</Command>
        <Command
            Condition="'%(NSwagTypeScriptCodeGeneratorDefaultOptions)' != ''">%(Command) %(NSwagTypeScriptCodeGeneratorDefaultOptions)</Command>
      </CurrentServiceFileReference>
    </ItemGroup>

    <Message Importance="high" Text="%0A%(CurrentServiceFileReference.Command)" />
    <Exec IgnoreExitCode="$([System.IO.File]::Exists('%(OutputPath)'))" Command="%(CurrentServiceFileReference.Command)" />
  </Target>
</Project>
